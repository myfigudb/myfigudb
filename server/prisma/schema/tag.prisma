enum TagStatus {
  PENDING
  VERIFIED
  REJECTED
}

model Tag {
  id    String @id @default(uuid()) @db.Uuid
  label String @unique

  status TagStatus @default(PENDING)

  created_by String @db.Uuid
  creator    User   @relation(fields: [created_by], references: [id])

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  figure_tags FigureTag[]

  @@map("tag")
}

enum FigureTagStatus {
  PENDING // Score < 200
  CONFIRMED // Score >= 200
  DEFINITIVE // Score >= 1000
}

model FigureTag {
  id String @id @default(uuid()) @db.Uuid

  figure_id String @db.Uuid
  tag_id    String @db.Uuid

  status FigureTagStatus @default(PENDING)

  added_by String @db.Uuid

  contributor User   @relation(fields: [added_by], references: [id])
  figure      Figure @relation(fields: [figure_id], references: [id])
  tag         Tag    @relation(fields: [tag_id], references: [id])

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  votes FigureTagVote[]

  @@map("figure_tag")
}

model FigureTagVote {
  figure_tag_id String @db.Uuid
  voted_by      String @db.Uuid

  //    value = (-/+)Base + ln(voter.lvl + 1) * Multiplicateur
  // EX: value = 50 + ln(21) * 30 = 141
  weight Int @default(100)

  figure_tag FigureTag @relation(fields: [figure_tag_id], references: [id])
  voter      User      @relation(fields: [voted_by], references: [id])

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@id([figure_tag_id, voted_by])
}
